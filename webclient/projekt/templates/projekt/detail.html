{% extends "base_logged_in.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{% trans "Detail projektu" %}{% endblock %}
{% block head %}
    <!-- Map imports -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin="">
    </script>

    <script>
        var global_csrftoken = '{{ csrf_token }}';
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">


{% endblock %}

{% block content %}

    <h1>{% trans "Projekt" %} <span class="badge badge-info">{{ projekt.get_stav_display }}</span>
        <a href="{% url 'projekt:projekt_edit' projekt.ident_cely %}" class="btn btn-success btn-lg">
        <span class="glyphicon glyphicon-edit"></span> {% trans "Edit" %}
      </a>
    </h1>

    <div class="card">
        <div class="card-header">{% trans "Detail" %}</div>
        <div class="card-body">
            <div class="row">
                <div class="col">{{ projekt.typ_projektu }}</div>
                <div class="col">{{ projekt.planovane_zahajeni }}</div>
                <div class="col"></div>
            </div>
            <div class="row">
                <div class="col">{{ katastry }}</div>
                <div class="col">{{ projekt.podnet }}</div>
            </div>
            <div class="row">
                <div class="col">{{ projekt.lokalizace }}</div>
                <div class="col">{{ projekt.parcelni_cislo }}</div>
            </div>
            <hr/>
            <h2>{% trans "Přihlášení" %}</h2>
            <div class="row">
                <div class="col">{{ projekt.organizace }}</div>
                <div class="col">{{ projekt.kulturni_pamatka }}</div>
            </div>
            <div class="row">
                <div class="col">{{ projekt.vedouci }}</div>
                <div class="col">{{ projekt.kulturni_pamatka_cislo }}</div>
            </div>
            <div class="row">
                <div class="col">{{ projekt.uzivatelske_oznaceni }}</div>
                <div class="col">{{ projekt.kulturni_pamatka_popis }}</div>
            </div>
            <hr/>
            <h2>{% trans "Výzkum" %}</h2>
            <div class="row">
                <div class="col">{{ projekt.datum_zahajeni }}</div>
                <div class="col">{{ projekt.datum_ukonceni }}</div>
            </div>
        </div>
    </div>
    <div class="card mt-2">
        <div class="card-header">{% trans "Oznámení" %}</div>
        <div class="card-body">
            <div class="row">
                <div class="col">{{ oznamovatel.oznamovatel }}</div>
                <div class="col">{{ oznamovatel.odpovedna_osoba }}</div>
            </div>
            <div class="row">
                <div class="col">{{ oznamovatel.email }}</div>
                <div class="col">{{ oznamovatel.telefon }}</div>
            </div>
            <div class="row">
                <div class="col">{{ oznamovatel.adresa }}</div>
            </div>
        </div>
    </div>

    <!-- TODO Tabulka projektové dokumentace -->

    <div class="card mt-2">
        <div class="card-header">{% trans "Archeologické akce" %}</div>
        <div class="card-body">
            {% for a in akce %}
                <div class="row">
                    <div class="col">{{ a.archeologicky_zaznam.ident_cely }}</div>
                    <div class="col">
                        <span class="badge badge-light">{{ a.archeologicky_zaznam.get_stav_display }}</span>
                    </div>
                    <div class="col">{{ a.archeologicky_zaznam.pristupnost }}</div>
                </div>
                <div class="row">
                    <div class="col">{{ a.archeologicky_zaznam.katasty }}</div>
                    <div class="col">{{ a.vedouci }}</div>
                </div>
                <div class="row">
                    <div class="col">
                        {{ a.datum_zahajeni_v }} - {{ a.datum_ukonceni_v }}
                    </div>
                    <div class="col">
                        {{ a.hlavni_typ }} {{ a.vedlejsi_typ }}
                    </div>
                </div>
                <div class="row">
                    <div class="col">{{ a.archeologicky_zaznam.uzivatelske_oznaceni }}</div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="container">
        <style>
            #projectMap {
                width: 100%;
                height: 473px;
                border-radius: 5px;
            }
        </style>
        <div id="projectMap"></div>
        <script src="{% static 'mapa.js' %}"></script>
        <script>
            global_map_can_edit=false;
            button_map_lock.disable();
            let coordinates='{{ projekt.geom.coords}}'.slice(1, -1).split(',');
            addPointOnLoad(coordinates[1],coordinates[0],"Uživatelem zadaná poloha záměru");
        </script>

    </div>

{% endblock %}

{% block script %}
{% endblock %}
