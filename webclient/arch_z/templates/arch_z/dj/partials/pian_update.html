{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% load template_filters %}

<div class="card app-card-form" id="detail_pian_form_{{ pian_ident_cely }}">
  <div class="card-header">
    <div class="app-fx app-left">
      {% trans "arch_z.templates.arch_z.dj.partials.pian_update.cardHeader.label" %}  {{ pian_ident_cely }}
    </div>
  </div>
  <div class="card-body">
    <form class="mb-3" method="POST" action="{% url 'pian:detail' pian_ident_cely %}"
          onsubmit="editPianButton.disabled = true; return true;">
      {% crispy pian_form_update %}
      {% if show.editovat %}
        <input type="hidden" name="dj_ident_cely" value="{{ dj_ident_cely }}">
        <button type="submit" id="editPianButton"
                class="btn btn-primary">{% trans "arch_z.templates.arch_z.dj.partials.pian_update.editButtons.upravitPian.label" %}</button>
      {% endif %}
    </form>
  </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById("djMap").scrollIntoView();
      let xhr = new XMLHttpRequest();
              xhr.open('POST', '/arch-z/mapa-zoom');
              xhr.setRequestHeader('Content-type', 'application/json');
              if (typeof global_csrftoken !== 'undefined') {
                  xhr.setRequestHeader('X-CSRFToken', global_csrftoken);
              } else {
                  console.log("neni X-CSRFToken token")
              }
              xhr.onload = function () {
                  rs = JSON.parse(this.responseText)
                  if(rs.lat>0){
                    map.setView([rs.lat, rs.lng], rs.zoom)
                  }
                  if (rs.zoom == 17) {
                      if(!global_blocked_by_query_geom){
                        drawnItems.clearLayers();
                        addGoldPointOnLoad([rs.lat, rs.lng],  drawnItems,'{{ dj_ident_cely }}',rs.geom,rs.presnost==4)
                      }
                  }
              };
              xhr.send(JSON.stringify(
                  {
                      'cadastre': document.getElementById("main_cadastre_id").value,
                      'pian': '{{ dj_ident_cely }}',
                  }))


        //show_form(`detail_pian_form_{{ pian_ident_cely}}`);
        map_show_edit(true);
        global_map_projekt_ident='{{ dj_ident_cely }}';
       // switchMap(true,'{{ pian_ident_cely}}')
    });
</script>
