{% extends "base_logged_in.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% load template_filters %}

{% block title %}{% trans "Detail archeologického záznamu - akce" %}{% endblock %}
{% block head %}
  <!-- Map imports -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
          integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
          crossorigin="">
  </script>
{% endblock %}

{% block content %}
<div class="app-entity-akce">
  {% include "toolbar_akce.html" with zaznam=zaznam  showbackdetail=True %}

  <div class="card app-card-form">
    <div class="card-header">
      <div class="app-fx app-left">
        {% trans "Detail" %}
      </div>
      <div class="app-fx app-right">
        <div class="btn-group" role="group">
          <div class="dropdown-menu" aria-labelledby="others">
            <a class="dropdown-item" href="#">{% trans "Smazat projekt" %}</a>
            <a class="dropdown-item" href="#">{% trans "Tisková sestava" %}</a>
            <a class="dropdown-item" href="#">{% trans "Expertní list" %}</a>
            <a class="dropdown-item" href="#">{% trans "Odeslat nové potvrzení" %}</a>
          </div>
          <button class="btn" type="button" id="others" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" rel="tooltip" data-placement="top" title="{% trans 'Další nabídka' %}">
            <span class="material-icons">more_vert</span>
          </button>
          <a class="btn" href="{% url 'arch_z:edit' zaznam.ident_cely %}" rel="tooltip"
             data-placement="top" title="{% trans 'Upravit' %}">
            <span class="material-icons">edit</span>
          </a>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Hlavní katastr" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.hlavni_katastr }}" readonly>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Přístupnost" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.pristupnost }}" readonly>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Další katastry" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.katastry.all|katastry_to_list }}" readonly>
          </div>
        </div>
        <div class="col-sm-12">
          <div class="form-group">
            <label>{% trans "Uživatelské označení" %}</label>
            <textarea class="textarea form-control" cols="40" rows="2" placeholder="{{ zaznam.uzivatelske_oznaceni }}"
                      readonly></textarea>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Hlavní vedoucí" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.akce.hlavni_vedouci }}" readonly>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Datum zahájení" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.akce.datum_zahajeni|date:'Y/m/d' }}"
                   readonly>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label>{% trans "Datum ukončení" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.akce.datum_ukonceni|date:'Y/m/d' }}"
                   readonly>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label>{% trans "Lokalizace okolností" %}</label>
            <textarea class="textarea form-control" cols="40" rows="2"
                      placeholder="{{ zaznam.akce.lokalizace_okolnosti }}" readonly></textarea>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label>{% trans "Uložení nálezu" %}</label>
            <textarea class="textarea form-control" cols="40" rows="2" placeholder="{{ zaznam.akce.ulozeni_nalezu }}"
                      readonly></textarea>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group">
            <label>{% trans "Hlavní typ" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.akce.hlavni_typ }}" readonly>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group">
            <label>{% trans "Vedlejší typ" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.akce.vedlejsi_typ }}" readonly>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group">
            <label>{% trans "Poznámka" %}</label>
            <input class="form-control" type="text" placeholder="{{ zaznam.poznamka }}" readonly>
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group">
            <label>{% trans "Odeslat ZAA jako NZ" %}</label>
            <input class="form-control" type="text"
                   placeholder="{% if zaznam.akce.je_nz == True %}Ano{% endif %} {% if zaznam.akce.je_nz == False %}Ne{% endif %}"
                   readonly>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-sm-4">
      <div class="card app-card-form">
        <div class="card-header">
          <div class="app-fx app-left">
            {% trans "Dokumentační jednotky" %}
          </div>
          <div class="app-fx app-right">
            <div class="btn-group" role="group">
              <button class="btn" onclick="show_form('create_dj_form')" rel="tooltip" data-placement="top" title="{% trans 'Přidat dokumentační jednotku' %}">
                <span class="material-icons">add</span>
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="list-group">
            {% for j in dokumentacni_jednotky %}
              <div class="list-group">
                <a href="#"
                   onclick="show_form('detail_dj_form_{{ j.ident_cely }}')">{{ j.ident_cely|last_three_letters }}({{ j.typ }})</a>
                {% for k in j.komponenty.komponenty.all %}
                  <div class="list-group-item">
                    <a href="#"
                       onclick="show_form('detail_komponenta_form_{{ k.ident_cely }}')">{{ k.ident_cely|last_three_letters }}({{ k.obdobi }}
                      - {{ k.areal }})</a>
                  </div>
                {% endfor %}
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-8">
      <style>
          #djMap {
              width: 100%;
              height: 473px;
              border-radius: 5px;
          }
      </style>
      <div id="djMap"></div>
    </div>
  </div>

  <!-- forms -->
  <div id="dj_forms" class="mb-3">
    <div class="card app-card-form" id="create_dj_form" style="display: none;">
      <div class="card-header">
        <div class="app-fx app-left">
          {% trans "Nová dokumentační jednotka" %}
        </div>
      </div>
      <div class="card-body">
        <form method="POST" action="{% url 'dj:zapsat' zaznam.ident_cely %}">
          {% crispy dj_form_create %}
          <button type="submit" class="btn btn-primary">{% trans "Vytovřit jednotku" %}</button>
        </form>
      </div>
    </div>
    {% for j in dj_forms_detail %}
      <div class="card app-card-form" id="detail_dj_form_{{ j.ident_cely }}" style="display: none;">
        <div class="card-header">
          <div class="app-fx app-left">
            {% trans "Dokumentační jednotka" %} {{ j.ident_cely }}
          </div>
          <div class="app-fx app-right">
            <div class="btn-group" role="group">
              <div class="dropdown-menu" aria-labelledby="others">
                <a class="dropdown-item" href="#" onclick="show_create_komponenta_form('{% url 'komponenta:zapsat' j.ident_cely %}')">{% trans 'Přidat komponentu' %}</a>
              </div>
              <button class="btn" type="button" id="others" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" rel="tooltip" data-placement="top" title="{% trans 'Další nabídka' %}">
                <span class="material-icons">more_vert</span>
              </button>
              <!-- <button class="btn" onclick="show_create_komponenta_form('{% url 'komponenta:zapsat' j.ident_cely %}')" rel="tooltip" data-placement="top" title="{% trans 'Přidat komponentu' %}">
                <span class="material-icons">add</span>
              </button> -->
            </div>
          </div>
        </div>
        <div class="card-body">
          <form method="POST" action="{% url 'dj:detail' j.ident_cely %}">
            {% crispy j.form %}
            <button type="submit" class="btn btn-primary">{% trans "Upravit jednotku" %}</button>
          </form>
        </div>
      </div>
    {% endfor %}

    <div class="card app-card-form" id="create_komponenta_form" style="display: none;">
      <div class="card-header">
        <div class="app-fx app-left">
          {% trans "Nová komponenta" %}
        </div>
      </div>
      <div class="card-body">
        <form method="POST" action="#" id="create_komponenta_form_id">
          {% crispy komponenta_form_create %}
          <button type="submit" class="btn btn-primary">{% trans "Vytovřit komponentu" %}</button>
        </form>
      </div>
    </div>

    <!-- dev -->
    {% for k in komponenta_forms_detail %}
      <div class="card app-card-form" id="detail_komponenta_form_{{ k.ident_cely }}" style="display: none;">
        <div class="card-header">
          <div class="app-fx app-left">
            {% trans "Komponenta" %} {{ k.ident_cely }}
          </div>
        </div>
        <div class="card-body">
          <form method="POST" action="{% url 'komponenta:detail' k.ident_cely %}">
            {% crispy k.form %}
            <button type="submit" class="btn btn-primary">{% trans "Upravit komponentu" %}</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="card app-card-form">
    <div class="card-header">
      <div class="app-fx app-left">
        {% trans "Dokumenty" %}
      </div>
      <div class="app-fx app-right">
        <div class="btn-group" role="group">
          <div class="dropdown-menu" aria-labelledby="others">
            <a class="dropdown-item" href="#">{% trans "Smazat projekt" %}</a>
            <a class="dropdown-item" href="#">{% trans "Tisková sestava" %}</a>
            <a class="dropdown-item" href="#">{% trans "Expertní list" %}</a>
            <a class="dropdown-item" href="#">{% trans "Odeslat nové potvrzení" %}</a>
          </div>
          <button class="btn" rel="tooltip" data-placement="top" title="{% trans 'Přidat dokument' %}">
            <span class="material-icons">add</span>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body">
      {% for d in dokumenty %}
        <div class="row">
          <div class="col">
            <a href="{% url 'dokument:detail' d.ident_cely %}">{{ d.ident_cely }}</a></div>
          <div class="col">
            <span class="badge badge-light">{{ d.get_stav_display }}</span>
          </div>
          <div class="col">{{ d.typ_dokumentu }}</div>
          <div clasd="col">{{ d.soubory.soubory|length }}</div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

  <!-- formy - puvodni po kontrole se cast tohoto zakomentovaneho kodu muze smazat -->
  <!-- <div id="dj_forms">
    <div id="create_dj_form" style="display: none;">
      <h3>Nová dokumentační jednotka</h3>
      <form method="POST" action="{% url 'dj:zapsat' zaznam.ident_cely %}">
        {% crispy dj_form_create %}
        <button type="submit" class="btn btn-primary">{% trans "Vytovřit jednotku" %}</button>
      </form>
    </div>

    {% for j in dj_forms_detail %}
      <div id="detail_dj_form_{{ j.ident_cely }}" style="display: none;">
        <h3>Dokumentační jednotka {{ j.ident_cely }}</h3>
        <button onclick="show_create_komponenta_form('{% url 'komponenta:zapsat' j.ident_cely %}')">Pridat komponentu
        </button>
        <form method="POST" action="{% url 'dj:detail' j.ident_cely %}">
          {% crispy j.form %}
          <button type="submit" class="btn btn-primary">{% trans "Upravit jednotku" %}</button>
        </form>
      </div>
    {% endfor %}

    <div id="create_komponenta_form" style="display: none;">
      <h3>Nová komponenta</h3>
      <form method="POST" action="#" id="create_komponenta_form_id">
        {% crispy komponenta_form_create %}
        <button type="submit" class="btn btn-primary">{% trans "Vytovřit komponentu" %}</button>
      </form>
    </div>

    {% for k in komponenta_forms_detail %}
      <div id="detail_komponenta_form_{{ k.ident_cely }}" style="display: none;">
        <h3>Komponenta {{ k.ident_cely }}</h3>
        <form method="POST" action="{% url 'komponenta:detail' k.ident_cely %}">
          {% crispy k.form %}
          <button type="submit" class="btn btn-primary">{% trans "Upravit komponentu" %}</button>
        </form>
      </div>
    {% endfor %}
  </div> -->

{% endblock %}

{% block script %}
  <script src="{% static 'arch_z_detail_map.js' %}"></script>
  <script>
      let shown_form_id = "";

      function show_form(form_id) {
          console.log(form_id)
          var form = document.getElementById(form_id);
          console.log(form)
          if (form.style.display === "none") {
              // hide the form what was shown
              if (shown_form_id !== "") {
                  document.getElementById(shown_form_id).style.display = "none"
              }
              // Show desired form
              form.style.display = "block";
              shown_form_id = form_id
          }
      }

      function show_create_komponenta_form(url) {
          console.log("show_create_komponenta_form");
          show_form('create_komponenta_form');
          var forma = document.getElementById("create_komponenta_form_id");
          forma.action = url;
      }

  </script>
{% endblock %}
