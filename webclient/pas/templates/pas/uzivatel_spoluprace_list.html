{% extends "base_logged_in.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% load render_table from django_tables2 %}
{% load export_url from django_tables2 %}

{% block title %}{% trans "Seznam spoluprací" %}{% endblock %}
{% block head %}{% endblock %}

{% block content %}
  <div class="app-entity-samostatny_nalez app-table-list-container">
    <div class="app-toolbar">
      <div class="app-left">
        <div class="app-entity-title">
          <a href="#"><span class="material-icons">brush</span> Spolupráce</a>
        </div>
      </div>
    </div>

    {% if filter %}
      <form method="get">
        <div class="mb-3 d-flex flex-row align-items-center justify-content-between">
          <div class="app-left">
            <a class="btn btn-primary" href="{% url 'pas:spoluprace_zadost' %}">{% trans 'Nová žádost o spolupráci' %}</a>
            <button class="btn btn-primary collapsed mr-1" type="button" data-toggle="collapse" data-target="#filter" aria-expanded="false" aria-controls="collapseExample">
              <span class="material-icons mr-1">filter_alt</span>{% trans "Filtr" %}<span class="material-icons app-icon-expand">expand_more</span>
            </button>
          </div>
          <div class="app-middle text-muted">
            {% trans "Počet nalezených spoluprací: " %}<strong>{{ table.rows|length }}</strong>
          </div>
          <div class="app-right">
            <div class="btn-group" role="group">
              <div class="btn-group" role="group">
                <button id="btnGroupDropTable" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" rel="tooltip" data-placement="top" title="{% trans 'Zobrazení sloupců' %}">
                  <span class="material-icons">table_chart</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="btnGroupDropTable">
                  {% for column in table.columns %}
                    {% if column.attrs.td.class in table.get_column_default_show %}
                      <a class="btn-shift-column dropdown-item"
                          data-td-class="{{ column.attrs.td.class }}"
                          data-state="on"
                          {% if not forloop.last %} style="border-bottom:1px solid #ccc;" {% endif %}
                          data-table-class-container="{{ table.uniq_table_class_name }}">
                        <img
                            src="{% static "django_tables2_column_shifter/img/check.png" %}"
                            alt="loader"
                            style="width:20px; height:20px; margin-right:5px; opacity:0.7;"
                            class="ico check"
                            id="ico_check_{{ column.name }}"
                        />
                        <img
                            src="{% static "django_tables2_column_shifter/img/uncheck.png" %}"
                            alt="loader"
                            style="width:20px; height:20px; margin-right:5px; display: none; opacity:0.7;"
                            class="ico uncheck"
                            id="ico_uncheck_{{ column.name }}"
                        />
                        {{ column.header }}
                      </a>
                    {% else %}
                      <a class="btn-shift-column dropdown-item"
                          data-td-class="{{ column.attrs.td.class }}"
                          data-state="off"
                          {% if not forloop.last %} style="border-bottom:1px solid #ccc;" {% endif %}
                          data-table-class-container="{{ table.uniq_table_class_name }}">
                        <img
                            src="{% static "django_tables2_column_shifter/img/check.png" %}"
                            alt="loader"
                            style="width:20px; height:20px; margin-right:5px; display:none; opacity:0.7;"
                            class="ico check"
                            id="ico_check_{{ column.name }}"
                        />
                        <img
                            src="{% static "django_tables2_column_shifter/img/uncheck.png" %}"
                            alt="loader"
                            style="width:20px; height:20px; margin-right:5px; opacity:0.7;"
                            class="ico uncheck"
                            id="ico_uncheck_{{ column.name }}"
                        />
                        {{ column.header }}
                      </a>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
              <div class="btn-group" role="group">
                <button id="btnGroupDropDownload" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" rel="tooltip" data-placement="top" title="{% trans 'Export výběru (při výběru většího množství záznamů může trvat delší dobu)' %}">
                  <span class="material-icons">download</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="btnGroupDropDownload">
                  {% for format in export_formats %}
                    <a href="{% export_url format %}" class="dropdown-item">
                      {% trans "Stáhnout" %} <code>.{{ format }}</code>
                    </a>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="collapse mb-3" id="filter">
          <div class="card app-card-form">
            <div class="card-body">
              {% crispy filter.form filter.helper %}
              <button type="submit" class="btn btn-primary">
                <span class="material-icons">check</span> {% trans "Vybrat spolupráce" %}
              </button>
            </div>
          </div>
        </div>
      </form>
    {% endif %}
    {% render_table table 'projekt/bootstrap4.html' %}
  </div>
{% endblock %}

{% block script %}
  <script
      type="text/javascript"
      src="{% static "django_tables2_column_shifter/js/django_tables2_column_shifter.min.js" %}">
  </script>
  <script>
    //modal scripts
    document.addEventListener('DOMContentLoaded', function (event) {
      if (document.getElementsByClassName("spoluprace-aktivovat-btn")){
        elements = document.getElementsByClassName("spoluprace-aktivovat-btn")
        for (let i = 0; i < elements.length; i++){
          var options = Object.assign(defaults, {modalID: "modal-form",
          formID: "aktivace-spoluprace-form",
          modalFormID: "#aktivace-spoluprace-form",
          })
          console.log(elements.item(i))
          new Modal(options, elements.item(i).id);
        }
      }
      if (document.getElementsByClassName("spoluprace-deaktivovat-btn")){
        elements = document.getElementsByClassName("spoluprace-deaktivovat-btn")
        for (let i = 0; i < elements.length; i++){
          var options = Object.assign(defaults, {modalID: "modal-form",
          formID: "deaktivace-spoluprace-form",
          modalFormID: "#deaktivace-spoluprace-form",
          })
          console.log(elements.item(i))
          new Modal(options, elements.item(i).id);
        }
      }
      if (document.getElementsByClassName("spoluprace-smazat-btn")){
        elements = document.getElementsByClassName("spoluprace-smazat-btn")
        for (let i = 0; i < elements.length; i++){
          var options = Object.assign(defaults, {modalID: "modal-form",
          formID: "smazani-spoluprace-form",
          modalFormID: "#smazani-spoluprace-form",
          })
          console.log(elements.item(i))
          new Modal(options, elements.item(i).id);
        }
      }
      $("tbody tr").each(function() {
        var item = $(this).find(".aktivace.spoluprace ");
        item.attr('data-original-title' , item.children().text());
        var item_smazani = $(this).find(".smazani.spoluprace ");
        item_smazani.attr('data-original-title' , item_smazani.children().text());
      });
      
  });
  
  </script>
{% endblock %}
