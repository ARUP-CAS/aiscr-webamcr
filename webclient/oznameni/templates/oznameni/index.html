{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{% trans "oznameni.templates.oznameni.index.title" %}{% endblock %}

{% block head %}
  <script>
      var global_csrftoken = '{{ csrf_token }}';
  </script>
  <!-- Map imports -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
          integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
          crossorigin="">
  </script>
  <!--Leaflet FullScreen-->
   <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
   <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css'
         rel='stylesheet'/>
  <!-- Date picker imports -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment-with-locales.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>

  <link rel="stylesheet" type="text/css" href="{% static 'bs-stepper.min.css' %}" />
  <!-- static leaflet additional import-->
  <link rel="stylesheet" href="{% static 'leaflet.measure.css' %}"/>
  <script src="{% static 'leaflet.measure.js' %}"></script>
  <script type="text/javascript" src="{% static 'leaflet.coor.js' %}"></script>
  <link rel="stylesheet" href="{% static 'leaflet.coor.css' %}"/>
  <link rel="stylesheet" type="text/css" href="{% static 'daterangepicker.css' %}"/>

  <link rel="stylesheet" href="{% static 'leaflet-search.css' %}"/>
  <script src="{% static 'leaflet-search.js' %}"></script>
{% endblock %}

{% block content %}

  {% include "oznameni/header.html" %}
  {% include "components/uvod.html" %}

  <div class="bs-stepper">
    <div class="bs-stepper-header">
      <div class="step active">
        <button type="button" class="btn step-trigger">
          <span class="bs-stepper-circle">1</span>
          <span class="bs-stepper-label">{% trans "oznameni.templates.oznameni.index.stepper.vytvoreniOznameni" %}</span>
        </button>
      </div>
      <div class="line"></div>
      <div class="step">
        <button type="button" class="btn step-trigger" disabled="disabled">
          <span class="bs-stepper-circle">2</span>
          <span class="bs-stepper-label">{% trans "oznameni.templates.oznameni.index.stepper.uploadProjDokumentace" %}</span>
        </button>
      </div>
      <div class="line"></div>
      <div class="step">
        <button type="button" class="btn step-trigger" disabled="disabled">
          <span class="bs-stepper-circle">3</span>
          <span class="bs-stepper-label">{% trans "oznameni.templates.oznameni.index.stepper.oznameno" %}</span>
        </button>
      </div>
    </div>
  </div>

  <form method="post">
    <div class="row mb-4">
      <div class="col-sm-12">
        {% crispy form_oznamovatel %}
      </div>

    </div>
    <div class="row mb-4">
      <div class="col-sm-6">
        {% crispy form_projekt %}
      </div>
      <div class="col-sm-6">
        <small id="hint_id_map"class="form-text text-muted">{% trans "oznameni.templates.oznameni.index.kliknutieMapa" %}</small>
        {% include "map.html" %}
      </div>
    </div>
    <div class="row mb-4 app-footer">
      <div class="col-sm-9">
        <button type="button" class="btn btn-secondary mt-0" data-toggle="modal" data-target="#precistPodminky">
          {% trans "oznameni.templates.oznameni.index.precistPodminky" %} <span class="material-icons">info</span>
        </button>
        <div class="form-check" id="div_id_souhlas" style="top: 3px;">
          <input class="form-check-input" type="checkbox" value="" id="id_souhlas" required="" name="souhlas">
          <label class="form-check-label requiredField" for="id_souhlas" for="defaultCheck1">
            {% trans "oznameni.templates.oznameni.index.souhlasSPodminkami" %}
            <span class="asteriskField">*</span>
          </label>
        </div>
        <div class="modal fade app-modal-podminky" id="precistPodminky" tabindex="-1" aria-labelledby="precistPodminkylLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">{% trans "oznameni.templates.oznameni.index.informaceGDPR" %}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                {% include "oznameni/podminky.html" %}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "oznameni.templates.oznameni.index.zavritPodminky" %}</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-3 text-right">
        <div class="app-captcha">
          {{ form_captcha }}
        </div>
        <button type="submit" name="save" id="submit-id-save" class="btn btn-primary mt-0">
          {% trans 'oznameni.templates.oznameni.index.dalsiKrok' %} <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    </div>
  </form>
{% endblock %}

{% block script %}
  <script >
    var static_url = "{% get_static_prefix %}";
  </script>
  <script>
    var map_translations = {
      cuzkzakladniMapyCr: '{%trans "mapa.cuzkzakladniMapyCr" %}',
      cuzkOrtofotomapa: '{%trans "mapa.cuzkOrtofotomapa" %}',
      cuzkStinovanyeelief5G: '{%trans "mapa.cuzkStinovanyeelief5G" %}',
      openStreetMapSeda:  '{%trans "mapa.openStreetMapSeda" %}',
    };
  </script>
  <script src="{% static 'coor_precision.js' %}"></script>
  <script src="{% static 'mapa_basic_grey.js' %}"></script>
  <script src="{% static 'mapa_pins.js' %}"></script>
  <script src="{% static 'mapa_oznameni.js' %}"></script>
  <script src="{% static 'daterangepicker.js' %}"></script>
  <script>
    window.onload = function (){
      load_daterangepicker("div_id_planovane_zahajeni")
      var addPointToPoiLayer = (lat, long, text) => {
            L.marker([lat, long],{icon: pinIconRedProject}).bindPopup(text).addTo(poi);
        }
      corX=document.getElementById('id_latitude').value;
      corY=document.getElementById('id_longitude').value;
      if(corX>0 ){
      addPointToPoiLayer(corX, corY, 'Vámi vybraná poloha záměru');
      }
    };
  </script>
{% endblock %}
